CREATE OR REPLACE PROCEDURE public.sp_incremental_sync_vendor_attr()
 LANGUAGE plpgsql
AS $$
DECLARE
        sql          VARCHAR(MAX) := '';
        staged_record_count BIGINT :=0;
BEGIN

     -- Truncate staging table

    EXECUTE 'TRUNCATE TABLE sap_fabric_p2p_stg.vendor_attr;';

    EXECUTE 'COPY JOB RUN auto_copy_vendor_attr';

--Execute MERGE on primary key to update and overwrite new/updated records

EXECUTE 'MERGE INTO sap_fabric_p2p_dm.vendor_attr
                USING sap_fabric_p2p_stg.vendor_attr stg 
                on (sap_fabric_p2p_dm.vendor_attr.supplier = stg.lifnr)
WHEN MATCHED THEN UPDATE SET
title=stg.anred,
train_station=stg.bahns,
location_no_1=stg.bbbnr,
location_no_2=stg.bbsnr,
_authorization=stg.begru,
industry=stg.brsch,
check_digit=stg.bubkz,
data_line=stg.datlt,
dme_rec_code=stg.dtams,
instruction_key=stg.dtaws,
created_on=stg.erdat,
created_by=stg.ernam,
isr_number=stg.esrnr,
_group=stg.konzs,
account_group=stg.ktokk,
customer=stg.kunnr,
ctryreg=stg.land1,
alternat_payee=stg.lnrza,
deletion_flag=stg.loevm,
name=stg.name1,
name_2=stg.name2,
name_3=stg.name3,
name_4=stg.name4,
city=stg.ort01,
district=stg.ort02,
po_box=stg.pfach,
po_box_pcode=stg.pstl2,
postal_code=stg.pstlz,
region=stg.regio,
search_term=stg.sortl,
posting_block=stg.sperr,
purch_block=stg.sperm,
language=stg.spras,
tax_number_1=stg.stcd1,
tax_number_2=stg.stcd2,
tax_number_3=stg.stcd3,
equalizatn_tax=stg.stkza,
liable_for_vat=stg.stkzu,
street=stg.stras,
telebox=stg.telbx,
telephone_1=stg.telf1,
telephone_2=stg.telf2,
fax_number=stg.telfx,
teletex=stg.teltx,
telex=stg.telx1,
onetime_acct=stg.xcpdk,
payee_in_doc=stg.xzemp,
trading_partner=stg.vbund,
fiscal_address=stg.fiskn,
vat_reg_no=stg.stceg,
natural_person=stg.stkzn,
block_function=stg.sperq,
name_mcod1=stg.mcod1,
name_2_mcod2=stg.mcod2,
city_mcod3=stg.mcod3,
place_of_birth=stg.gbort,
date_of_birth=stg.gbdat,
sex=stg.sexkz,
info_number=stg.kraus,
last_extreview=stg.revdb,
actual_qm_sys=stg.qssys,
refacct_group=stg.ktock,
pobox_city=stg.pfort,
plant=stg.werks,
vsr_relevant=stg.ltsna,
plant_relevant=stg.werkr,
factory_calend=stg.plkal,
tax_jur=stg.txjcd,
payment_block=stg.sperz,
address=stg.adrnr,
tax_number_4=stg.stcd4,
tax_number_5=stg.stcd5,
odq_changemode=stg.odq_changemode,
odq_entitycntr=stg.odq_entitycntr

WHEN NOT MATCHED THEN
    INSERT (supplier,
title,
train_station,
location_no_1,
location_no_2,
_authorization,
industry,
check_digit,
data_line,
dme_rec_code,
instruction_key,
created_on,
created_by,
isr_number,
_group,
account_group,
customer,
ctryreg,
alternat_payee,
deletion_flag,
name,
name_2,
name_3,
name_4,
city,
district,
po_box,
po_box_pcode,
postal_code,
region,
search_term,
posting_block,
purch_block,
language,
tax_number_1,
tax_number_2,
tax_number_3,
equalizatn_tax,
liable_for_vat,
street,
telebox,
telephone_1,
telephone_2,
fax_number,
teletex,
telex,
onetime_acct,
payee_in_doc,
trading_partner,
fiscal_address,
vat_reg_no,
natural_person,
block_function,
name_mcod1,
name_2_mcod2,
city_mcod3,
place_of_birth,
date_of_birth,
sex,
info_number,
last_extreview,
actual_qm_sys,
refacct_group,
pobox_city,
plant,
vsr_relevant,
plant_relevant,
factory_calend,
tax_jur,
payment_block,
address,
tax_number_4,
tax_number_5,
odq_changemode,
odq_entitycntr

)
    VALUES (
            stg.lifnr,
stg.anred,
stg.bahns,
stg.bbbnr,
stg.bbsnr,
stg.begru,
stg.brsch,
stg.bubkz,
stg.datlt,
stg.dtams,
stg.dtaws,
stg.erdat,
stg.ernam,
stg.esrnr,
stg.konzs,
stg.ktokk,
stg.kunnr,
stg.land1,
stg.lnrza,
stg.loevm,
stg.name1,
stg.name2,
stg.name3,
stg.name4,
stg.ort01,
stg.ort02,
stg.pfach,
stg.pstl2,
stg.pstlz,
stg.regio,
stg.sortl,
stg.sperr,
stg.sperm,
stg.spras,
stg.stcd1,
stg.stcd2,
stg.stcd3,
stg.stkza,
stg.stkzu,
stg.stras,
stg.telbx,
stg.telf1,
stg.telf2,
stg.telfx,
stg.teltx,
stg.telx1,
stg.xcpdk,
stg.xzemp,
stg.vbund,
stg.fiskn,
stg.stceg,
stg.stkzn,
stg.sperq,
stg.mcod1,
stg.mcod2,
stg.mcod3,
stg.gbort,
stg.gbdat,
stg.sexkz,
stg.kraus,
stg.revdb,
stg.qssys,
stg.ktock,
stg.pfort,
stg.werks,
stg.ltsna,
stg.werkr,
stg.plkal,
stg.txjcd,
stg.sperz,
stg.adrnr,
stg.stcd4,
stg.stcd5,
stg.odq_changemode,
stg.odq_entitycntr
    );';

END
$$